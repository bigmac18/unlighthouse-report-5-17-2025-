'use strict';

const core = require('@unlighthouse/core');
const h3 = require('h3');
const listhen = require('listhen');

async function createServer() {
  const { resolvedConfig } = core.useUnlighthouse();
  const app = h3.createApp();
  const server = await listhen.listen(h3.toNodeListener(app), {
    // @ts-expect-error untyped
    ...resolvedConfig.server,
    // delay opening the server until the app is ready
    open: false
  });
  return { app, server };
}

exports.createServer = createServer;
