import { useUnlighthouse } from '@unlighthouse/core';
import { createApp, toNodeListener } from 'h3';
import { listen } from 'listhen';

async function createServer() {
  const { resolvedConfig } = useUnlighthouse();
  const app = createApp();
  const server = await listen(toNodeListener(app), {
    // @ts-expect-error untyped
    ...resolvedConfig.server,
    // delay opening the server until the app is ready
    open: false
  });
  return { app, server };
}

export { createServer };
